<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>マスター管理</title>
  <link rel="stylesheet" href="/public/styles.css">
</head>
<body>
  <header class="header">
    <h1>マスター管理</h1>
    <p class="sub">タブ切替／is_active をワンクリック反転</p>
  </header>

  <main class="container">
    <div class="tabs" id="tabs">
      <% (mastersData || []).forEach((m, idx) => { %>
        <button
          class="tab <%= idx === 0 ? 'active' : '' %>"
          data-target="<%= m.key %>"
          data-table="<%= m.table %>"
        >
          <%= m.label %>
        </button>
      <% }) %>
    </div>

    <% (mastersData || []).forEach((m, idx) => { %>
      <section class="panel <%= idx === 0 ? '' : 'hidden' %>" data-panel="<%= m.key %>">
        <h2><%= m.table %></h2>

        <table class="master-table">
          <thead>
            <tr>
              <th style="width:80px;">ID</th>
              <th>name</th>
              <th style="width:90px;">inch</th>
              <th style="width:220px;">supplier</th>
              <th style="width:120px;">is_active</th>
              <th style="width:160px;">操作</th>
            </tr>
          </thead>

          <tbody>
            <% (m.rows || []).forEach(item => { 
                 // is_active が「あるテーブル」だけ ON/OFF 表示
                 const hasIsActive = (typeof m.hasIsActive !== 'undefined') ? m.hasIsActive : (item.is_active !== null && typeof item.is_active !== 'undefined');
                 const isActive = (item.is_active === 1 || item.is_active === true);
                 const isInactiveRow = hasIsActive && !isActive;
            %>
              <tr class="<%= isInactiveRow ? 'inactive-row' : '' %>">
                <td><%= item.id %></td>

                <td>
                  <a href="/masters/<%= m.table %>/<%= item.id %>" class="detail-link">
                    <%= item.label %>
                  </a>
                </td>

                <td><%= item.inch ?? '―' %></td>
                <td><%= item.supplier_name ?? '―' %></td>

                <td>
                  <% if (!hasIsActive) { %>
                    <span class="badge">―</span>
                  <% } else { %>
                    <span class="badge <%= isActive ? 'on' : 'off' %>">
                      <%= isActive ? 'ON' : 'OFF' %>
                    </span>
                  <% } %>
                </td>

                <td>
                  <% if (!hasIsActive) { %>
                    <span style="color:#6b7280;">―</span>
                  <% } else { %>
                    <button
                      class="toggle-active-btn"
                      data-table="<%= m.table %>"
                      data-id="<%= item.id %>"
                    >
                      <%= isActive ? '無効にする' : '有効にする' %>
                    </button>
                  <% } %>
                </td>
              </tr>
            <% }) %>

            <% if (!m.rows || m.rows.length === 0) { %>
              <tr>
                <td colspan="6" style="color:#6b7280; padding:14px;">
                  データがありません
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </section>
    <% }) %>
  </main>

  <!-- FAB（右下＋） -->
  <button class="fab" id="fabBtn" type="button"
    aria-haspopup="true" aria-expanded="false" aria-controls="fabMenu" title="新規登録">
    <span class="fab-plus" aria-hidden="true">＋</span>
  </button>

  <!-- 吹き出しメニュー -->
  <div class="fab-menu hidden" id="fabMenu" role="menu" aria-label="新規登録メニュー">
    <!-- ※ 自動化したので table が必須になる。table未指定だと 400 になるので注意 -->
    <a class="fab-item" href="/masters/register" role="menuitem" id="fabToForm">
      <span class="fab-item-title">フォームで登録</span>
      <span class="fab-item-sub">1件ずつ入力</span>
    </a>

    <a class="fab-item" href="/masters/upload" role="menuitem" id="fabToCsv">
      <span class="fab-item-title">CSVで一括登録</span>
      <span class="fab-item-sub">まとめて投入</span>
    </a>
  </div>

  <div class="fab-backdrop hidden" id="fabBackdrop" aria-hidden="true"></div>

  <script src="/public/master.js"></script>
</body>
</html>
